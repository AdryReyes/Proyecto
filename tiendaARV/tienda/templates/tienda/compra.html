{% extends 'tienda/base.html' %}

{% load i18n %}

{% block content %}
    {% if producto_agregado %}
        <p>¡El producto se ha agregado al carrito!</p>
    {% endif %}

    <h1>{% trans "Página de Compra" %}</h1>

    <div>
        <div>
            <div>{% trans "Nombre:" %}<div>{{ producto.producto_nombre }}</div></div>
            <div>{% trans "Marca:" %}<div>{{ producto.marca }}</div></div>
            <div>{% trans "Modelo:" %}<div>{{ producto.producto_modelo }}</div></div>
            <div>{% trans "Unidades disponibles:" %}<div>{{ producto.producto_unidades }}</div></div>
            <div>{% trans "Precio:" %}<div>{{ producto.producto_precio }}€</div></div>
            <br>
            {% if producto.vip %}
                <div>{% trans "El producto es VIP" %}</div>
            {% endif %}
            {% if request.user.is_authenticated %}
                {% if request.user.cliente %}
                    {% if producto.vip and not request.user.cliente.vip %}
                        <div>
                            {% trans "Solo los usuarios VIP pueden comprar productos VIP." %}
                        </div>
                    {% else %}
                        <form method="post">
                            {% csrf_token %}
                            <input type="number" name="cantidad" value="1" min="1" max="{{ producto.unidades }}">
                            <button type="submit">{% trans "Comprar" %}</button>
                        </form>
                        {% if messages %}
                            <div>
                                {% for message in messages %}
                                    {{ message }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <div>
                        No puedes comprar productos al no ser cliente.
                    </div>
                {% endif %}
            {% else %}
                <div>
                    Inicia sesión para comprar este producto.
                </div>
            {% endif %}
        </div>
    </div>

    <div>
        <h2>{% trans "Comentarios del producto" %}</h2>
        {% if comentarios %}
            {% for comentario in comentarios %}
                <div>
                    <p>{{ comentario.comentario }}</p>
                    <p>Por: {{ comentario.user.username }}</p>
                    <p>Fecha: {{ comentario.fecha }}</p>
                    {% if comentario.valoracion %}
                        <p>Valoración: {{ comentario.valoracion }}</p>
                    {% endif %}
                </div>
            {% empty %}
                <p>No hay comentarios aprobados para este producto</p>
            {% endfor %}
        {% else %}
            <p>No hay comentarios para este producto</p>
        {% endif %}
        {% if valoracion_media %}
            <p>Valoración media del producto: {{ valoracion_media }}</p>
        {% endif %}
    </div>
{% endblock %}